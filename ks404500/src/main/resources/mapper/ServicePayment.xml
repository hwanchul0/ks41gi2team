<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart41_teamtest.mapper.ServicePaymentMapper">
	<resultMap type="ServicePayment" id="paymentResultMap">
		<result column="contractManageCode" 			property="contractManageCode"/>
		<result column="serviceName" 					property="serviceName"/>
		<result column="serviceAmount" 					property="serviceAmount"/>
		<result column="servicePeriod" 					property="servicePeriod"/>
		<result column="serviceTotalPrice" 				property="serviceTotalPrice"/>
		<result column="serviceRequestDate" 			property="serviceRequestDate"/>
		<result column="serviceRegistrationDate" 		property="serviceRegistrationDate"/>
		<result column="serviceEndDate" 				property="serviceEndDate"/>
		<result column="serviceRequestStatus" 			property="serviceRequestStatus"/>
		<result column="serviceApprovalDate" 			property="serviceApprovalDate"/>
		<result column="clientId" 						property="clientId"/>
	</resultMap>		
	<!-- 계약요청 결제예정  조회 ( sw) -->
		<select id="getServicePaymentSum" parameterType="String" resultMap="paymentResultMap">
			SELECT 
				p.paymentCode
				,p.contractManageCode
				,p.slipNumber
				,p.servicePaymentDueDate
				,p.paymentSumRegistration
				,s.paymentState
			FROM 
				k2_sw_paymentSum AS p
				INNER JOIN 
				k2_sw_paymentCheck AS c
			ON 
				p.paymentCode = c.paymentCode
				INNER join
				k2_paymentState AS s
			ON 
				c.paymentStateCode = s.paymentStateCode
			ORDER BY p.paymentSumRegistration ASC;
		</select>
	<!-- 계약요청 결제예정 확인 -->
		<select id="servicePaymentCheck" resultType="ServicePayment" resultMap="paymentResultMap">
			SELECT 
				c.clientId
				,p.paymentCode
				,p.contractManageCode
				,p.slipNumber
				,c.paymentEstimate
				,c.paymentCharge
				,c.paymentBalance
				,c.paymentType
				,c.paymentDate
				,c.paymentStateCode
			FROM 
				k2_sw_paymentSum AS p
				INNER JOIN 
				k2_sw_paymentCheck AS c
			ON 
				p.paymentCode = c.paymentCode
				INNER JOIN 
				k2_paymentState AS s
			ON 
				c.paymentStateCode = s.paymentStateCode
			WHERE
				p.paymentCode = #{paymentCode};				
		</select>
		
		<!-- 서비스 결제확인 결제상태 리스트 조회 -->
		<select id="getPaymentStateCode" resultType="PaymentState">
		SELECT
			 p.paymentStateCode AS paymentStateCode
			,p.paymentState	AS paymentState
		FROM 
			k2_paymentState AS p;
		</select>
		
		<update id="modifyPaymentStateCode" parameterType="String">
		UPDATE k2_sw_paymentCheck
			SET
				paymentStateCode=#{servicePaymentCheck}
			WHERE 
				paymentCode=#{paymentStateCode}
		</update>
		
		<!-- 계약현황 -->
		<select id="selectContractState" resultType="ServicePayment">
		SELECT 
			k.clientId
			,n.contractCode
			,s.paymentState
			,c.contractState
			,r.refundState
			,n.refundReason
			,n.serviceRegistrationDate
			,n.serviceDeleteDate
			,n.contractRegDate
		FROM 
			k2_sw_normalContractState AS n
			left JOIN 
			k2_sw_contractRefundState AS r
			ON 
			n.refundStateCode = r.refundStateCode
			INNER JOIN 
			k2_sw_contractState AS c
			ON 
			n.contractStateCode = c.contractStateCode
			INNER JOIN 
			k2_sw_paymentCheck AS k
			ON 
			n.paymentCheckCode = k.paymentCheckCode
			INNER JOIN 
			k2_paymentState AS s
			ON 
			k.paymentStateCode = s.paymentStateCode;
		</select>
		<!-- 계약현황 수정 -->
		<select id="getContractState" resultType="ServicePayment">
		SELECT 
			k.clientId
			,n.contractCode
			,s.paymentState
			,c.contractState
			,r.refundState
			,n.refundReason
			,n.serviceRegistrationDate
			,n.serviceDeleteDate
			,n.contractRegDate
		FROM 
			k2_sw_normalContractState AS n
			left JOIN 
			k2_sw_contractRefundState AS r
			ON 
			n.refundStateCode = r.refundStateCode
			INNER JOIN 
			k2_sw_contractState AS c
			ON 
			n.contractStateCode = c.contractStateCode
			INNER JOIN 
			k2_sw_paymentCheck AS k
			ON 
			n.paymentCheckCode = k.paymentCheckCode
			INNER JOIN 
			k2_paymentState AS s
			ON 
			k.paymentStateCode = s.paymentStateCode;
		</select>
		
</mapper>