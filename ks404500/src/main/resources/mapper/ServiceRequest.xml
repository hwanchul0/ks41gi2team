<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart41_teamtest.mapper.ServiceRequestMapper">
	<resultMap type="ServiceRequest" id="requestResultMap">
		<result column="contractManageCode" 							property="contractManageCode"/>
		<result column="serviceName" 									property="serviceName"/>
		<result column="serviceAmount" 									property="serviceAmount"/>
		<result column="servicePeriod" 									property="servicePeriod"/>
		<result column="serviceTotalPrice" 								property="serviceTotalPrice"/>
		<result column="serviceRequestDate" 							property="serviceRequestDate"/>
		<result column="serviceRegistrationDate" 						property="serviceRegistrationDate"/>
		<result column="serviceEndDate" 								property="serviceEndDate"/>
		<result column="serviceRequestStatus" 							property="serviceRequestStatus"/>
		<result column="serviceApprovalDate" 							property="serviceApprovalDate"/>
		<result column="clientId" 										property="clientId"/>
		<result column="mainBusinessCode" 								property="mainBusinessCode"/>
		<result column="businessCode" 									property="businessCode"/>
		<result column="businessLevelCode" 								property="businessLevelCode"/>
		<result column="businessRegistrationCode" 						property="businessRegistrationCode"/>
		<result column="businessCodeRegistrationDate" 					property="businessCodeRegistrationDate"/>
	</resultMap>		
	<!-- 계약요청 전체 조회 ( sw) -->
		<select id="getAllRequestList" parameterType="String" resultMap="requestResultMap">
			SELECT
				bR.clientId
				,r.contractManageCode
				,m.serviceName
				,r.serviceAmount
				,r.servicePeriod
				,r.serviceTotalPrice
				,r.serviceRequestDate
				,r.serviceRegistrationDate
				,r.serviceEndDate
				,r.serviceRequestStatus
				,r.serviceApprovalDate
			FROM
				k2_sw_contractRequest AS r
				INNER JOIN 
				k2_sw_serviceManagement AS m
				ON 
				r.serviceCode = m.serviceCode
				INNER JOIN 
				k0_sw_mainBusinessCodeManagement AS mB
			ON 
				r.mainBusinessCode = mB.mainBusinessCode
				INNER JOIN 
				k0_sw_businessRegistration AS bR
			ON 
				mB.businessRegistrationCode = bR.businessRegistrationCode
			GROUP BY bR.clientId
			ORDER BY serviceRequestDate ASC;
	</select>
	<!-- 계약요청 조회 (shop-client) -->
		<select id="getRequestList" parameterType="String" resultMap="requestResultMap">
			SELECT
				r.contractManageCode
				,m.serviceName
				,r.serviceAmount
				,r.servicePeriod
				,r.serviceTotalPrice
				,r.serviceRequestDate
				,r.serviceRegistrationDate
				,r.serviceEndDate
				,r.serviceRequestStatus
				,r.serviceApprovalDate
			FROM
				k2_sw_contractRequest AS r
				INNER JOIN 
				k2_sw_serviceManagement AS m
			ON
				r.serviceCode = m.serviceCode
				INNER JOIN 
				k0_sw_mainBusinessCodeManagement AS mB
				ON 
				r.mainBusinessCode = mB.mainBusinessCode
				INNER JOIN 
				k0_sw_businessRegistration AS bR
			ON 
				bR.businessRegistrationCode = mB.businessRegistrationCode
			WHERE 
			shopMemberId = #{shopMemberId}
			ORDER BY serviceRequestDate ASC;
	</select>
	<!-- 계약요청 상세정보 (sw) -->
	<select id="getDetailRequestList" resultType="ServiceRequest" resultMap="requestResultMap">
			SELECT
				 bR.clientId
				,r.contractManageCode
				,m.serviceName
				,r.serviceAmount
				,r.servicePeriod
				,r.serviceTotalPrice
				,r.serviceRequestDate
				,r.serviceRegistrationDate
				,r.serviceEndDate
				,r.serviceRequestStatus
				,r.serviceApprovalDate
			FROM
				k2_sw_contractRequest AS r
				INNER JOIN 
				k2_sw_serviceManagement AS m
			ON
				r.serviceCode = m.serviceCode
				INNER JOIN 
				k0_sw_mainBusinessCodeManagement AS mB
			ON 
				r.mainBusinessCode = mB.mainBusinessCode
				INNER JOIN 
				k0_sw_businessRegistration AS bR
			ON 
				mB.businessRegistrationCode = bR.businessRegistrationCode
			WHERE 
				contractManageCode = #{contractManageCode}
			GROUP BY bR.clientId
			ORDER BY r.serviceRequestDate ASC; 		
	</select>
	<!-- 서비스 등록 | 내 사업장대표코드 modal -->
	<select id="findMyMainBizCode" parameterType="String" resultType="map">
    SELECT 
		main.mainBusinessCode
		,main.businessCode
		,main.businessLevelCode
		,main.businessRegistrationCode
		,main.businessCodeRegistrationDate
	FROM 
		k0_sw_mainBusinessCodeManagement AS main
	INNER JOIN 
		k0_sw_businessRegistration AS bR
	ON 
		main.businessRegistrationCode = bR.businessRegistrationCode
	INNER JOIN 
		k2_shop_member AS m
	ON 
		bR.shopMemberId = m.shopMemberId
	WHERE 
		m.shopMemberId = #{shopMemberId};
	</select>
	
	<!-- 계약요청 삭제 -->
	<delete id="deleteServiceRequest" parameterType="ServiceRequest">
	DELETE 
	FROM 
		k2_sw_contractRequest 
	WHERE 
		contractManageCode=#{contractManageCode};
	</delete>

</mapper>